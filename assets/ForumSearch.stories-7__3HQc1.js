import{an as O,r,j as e,W as F,bR as E,al as T,Y as m,du as U,dt as D,jg as k,jh as C,ji as V,jj as w,jk as A,ck as M,K as P,bW as q,bf as L,B as $}from"./iframe-D4dZwAiu.js";import{N as K}from"./NoSearchResults-Cmgcvc1k.js";import{u as G}from"./useEntity-CLsVNppT.js";import{c as z}from"./useForum-DQHGpD6W.js";import{S as W}from"./Search-DCgEACzY.js";import{S as Y}from"./SkeletonParagraph-CCi1oakt.js";import{U as H}from"./UserBadge-C4q-1h63.js";import{I as B}from"./InputAdornment-BTfnifga.js";import"./index-Chi_LkuB.js";import"./pickBy-Bir1C-NQ.js";import"./isString-B22YpsO2.js";import"./_baseIteratee-hrWHcORH.js";import"./useInfiniteQuery-97YTJVGW.js";import"./InfiniteQueryUtils-CKlRW-xB.js";import"./useEntityBundle-ClqOATdC.js";import"./useUserBundle-DJaOK7gx.js";import"./SkeletonTable-8IE5S5u8.js";import"./MenuItem-i2UFDYLy.js";import"./Card-BgubtV-0.js";import"./Chip-BrFyeTvK.js";const N=async s=>(await fetch(s,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text(),v=s=>{const{threadId:d,replyId:a}=s,{accessToken:o}=O(),[n,S]=r.useState(),[h,g]=r.useState(""),[u,_]=r.useState(),[R,y]=r.useState(),[f,j]=r.useState(!1);r.useEffect(()=>{(async()=>{let i;j(!0);const c=await k(d,o);if(a){const l=await C(a,o);i=await V(l.messageKey,o),y(await w(l.createdBy)),_(l)}else y(await w(c.createdBy)),i=await A(c.messageKey,o);g(await N(i.messageUrl)),S(c),j(!1)})()},[o,a,d]);const x=(p,i,c)=>{let l=`${M.PORTAL}Synapse:${i}/discussion/threadId=${p}`;return c&&(l+=`&replyId=${c}`),l};return e.jsx("div",{className:"search-result-container",children:e.jsxs(F,{sx:{display:"grid",gridTemplateColumns:"40px auto"},children:[e.jsx("div",{children:f?e.jsx(E,{variant:"circular",width:"30px",height:"30px"}):a?e.jsx(T,{icon:"replyTwoTone"}):e.jsx(T,{icon:"chatTwoTone"})}),e.jsx("div",{children:f?e.jsx(Y,{numRows:4}):e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"headline3",gutterBottom:!0,children:e.jsx("a",{className:"link",href:x(n?.id,n?.projectId,u?.id),children:n?.title})}),e.jsx("div",{className:"truncated",children:e.jsx(m,{variant:"body1",gutterBottom:!0,children:h})}),e.jsxs("div",{className:"search-result-footer",children:[a?"Reply":"Thread"," by"," ",e.jsx(H,{userId:R?.ownerId})," ",U(D(u?.createdOn))]})]})})]})})};try{N.displayName="getMessage",N.__docgenInfo={description:"",displayName:"getMessage",props:{}}}catch{}try{v.displayName="DiscussionSearchResult",v.__docgenInfo={description:"",displayName:"DiscussionSearchResult",props:{threadId:{defaultValue:null,description:"",name:"threadId",required:!0,type:{name:"string"}},replyId:{defaultValue:null,description:"",name:"replyId",required:!1,type:{name:"string"}}}}}catch{}const J=()=>e.jsxs(F,{sx:{textAlign:"center"},children:[e.jsx(K,{height:"181px",sx:{pt:"40px",pb:"10px"}}),e.jsx(m,{variant:"body1",children:"No results with this query"}),e.jsx(m,{variant:"body1Italic",children:"Search the full text of posts, replies, and titles"})]}),b=s=>{const{onSearchResultsVisible:d}=s,[a,o]=r.useState(""),[n,S]=r.useState(""),[h,g]=r.useState(!1),{data:u}=G(s.projectId,void 0,{enabled:!!s.projectId}),{data:_,isLoading:R,hasNextPage:y,isFetchingNextPage:f,fetchNextPage:j,error:x}=z(s.forumId,{searchString:n},{enabled:!!n});r.useEffect(()=>{x&&P(x.reason,"danger")},[x]);const p=_?.pages.flatMap(t=>t.matches??[])??[],i=!R&&n&&p.length==0,c=()=>{g(!1),o("")};function l(){S(a),g(!0)}return r.useEffect(()=>{d&&d(h)},[h,d]),e.jsxs("div",{className:"ForumSearch",children:[e.jsx("div",{children:e.jsx(q,{sx:t=>({[t.breakpoints.down("md")]:{width:"100%"}}),type:"search",placeholder:"Search discussions",value:a,onChange:t=>{o(t.target.value)},onKeyDown:t=>{t.key==="Enter"&&l()},slotProps:{input:{startAdornment:e.jsx(B,{position:"start",children:e.jsx(W,{})}),endAdornment:a&&e.jsx(B,{position:"end",children:e.jsx(L,{size:"small",onClick:()=>{c()},children:e.jsx(T,{icon:"clear",wrap:!1})})})}}})}),h&&e.jsxs(e.Fragment,{children:[i&&e.jsxs(e.Fragment,{children:[s.projectId&&u&&e.jsxs(m,{variant:"body1Italic",className:"NoResultsText",children:['No results for "',n,'" in ',u?.name]}),e.jsx(J,{})]}),p&&e.jsxs(e.Fragment,{children:[s.projectId&&!i&&e.jsxs(m,{variant:"body1Italic",className:"ResultsText",sx:{my:2,mx:1},children:['Results for "',n,'" in ',u?.name,":"]}),p.map(t=>e.jsx("div",{children:e.jsx(v,{threadId:t.threadId,replyId:t.replyId})},`${t.forumId}-${t.threadId}-${t.replyId}`))]}),y&&e.jsx($,{variant:"contained",color:"primary",disabled:f,onClick:()=>{j()},sx:{mx:1,mt:2},children:"Load more"})]})]})};try{b.displayName="ForumSearch",b.__docgenInfo={description:"",displayName:"ForumSearch",props:{forumId:{defaultValue:null,description:"",name:"forumId",required:!0,type:{name:"string"}},projectId:{defaultValue:null,description:"",name:"projectId",required:!1,type:{name:"string"}},onSearchResultsVisible:{defaultValue:null,description:"",name:"onSearchResultsVisible",required:!1,type:{name:"(visible: boolean) => void"}}}}}catch{}const{fn:Q}=__STORYBOOK_MODULE_TEST__,fe={title:"Synapse/ForumSearch",component:b},I={args:{forumId:"1032",onSearchResultsVisible:Q()}};I.parameters={...I.parameters,docs:{...I.parameters?.docs,source:{originalSource:`{
  args: {
    forumId: '1032',
    onSearchResultsVisible: fn()
  }
}`,...I.parameters?.docs?.source}}};const je=["Demo"];export{I as Demo,je as __namedExportsOrder,fe as default};
