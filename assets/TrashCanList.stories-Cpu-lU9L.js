import{aH as I,an as x,aI as R,ab as C,r as c,j as t,hf as D,Y as f,dY as L,c4 as P,W as N,B as p,dh as Q,dG as q,dF as K}from"./iframe-Dmz0OYQW.js";import{u as z}from"./useInfiniteQuery-BvWsAshg.js";import{g as V}from"./InfiniteQueryUtils-CKlRW-xB.js";import{u as Y,S as H,c as O,g as A}from"./StyledTanStackTable-BR0hQt0X.js";import{C as W,a as G}from"./EntityHeaderTableCellRenderers-DS2e1ygw.js";import{E as _}from"./EntityLink-B8y_f3c3.js";import{W as J}from"./WarningDialog-BXDRyJYn.js";import"./index-Chi_LkuB.js";import"./StyledTableContainer-CBGRndeA.js";import"./ExpandCollapseButton-CC81WoiL.js";import"./index-RuS5zw0r.js";import"./Checkbox-DYbJ9vmj.js";import"./SwitchBase-94QFIekX.js";import"./useEntity-DCJfD9JE.js";import"./pickBy-BCa-CFjS.js";import"./isString-CBMbF9Nh.js";import"./_baseIteratee-OyrRg5lQ.js";import"./useQueries-Gj-Mwc6j.js";import"./useSuspenseQuery-DBtfLQcz.js";import"./useEntityBundle-U54fuo6y.js";import"./useGetEntityHeaders-BnMPdQ_k.js";import"./EntityIcon-Bi5gmTUB.js";import"./ErrorChip-B8CD5IP6.js";import"./Chip-CDOlQzO-.js";import"./ConfirmationDialog-91A2i7b8.js";import"./DialogBase-D4eQljKx.js";import"./Close-DJMVqFXZ.js";import"./HelpPopover-DDEeoZql.js";import"./MarkdownPopover-BJM8rGXo.js";import"./LightTooltip-B4ee2TOH.js";import"./MarkdownSynapse-BRO4x38K.js";import"./SkeletonButton--ocR4MjZ.js";import"./SkeletonInlineBlock-DMCr-ZDU.js";import"./SkeletonTable-DZOOfuw_.js";import"./SkeletonParagraph-BbQFsbPl.js";function U(r){const{accessToken:e,keyFactory:i}=x();return z({...r,queryKey:i.getTrashCanItemsQueryKey(),queryFn:l=>C.getItemsInTrashCan(e,l.pageParam),initialPageParam:void 0,getNextPageParam:V})}function X(r){const e=I(),{accessToken:i,keyFactory:l}=x();return R({...r,mutationFn:a=>{typeof a=="string"&&(a=new Set([a]));const s=Array.from(a).map(o=>C.restoreFromTrashCan(o,i));return Promise.allSettled(s)},onSuccess:async(a,s,o)=>{await e.invalidateQueries({queryKey:l.getTrashCanItemsQueryKey()}),r?.onSuccess&&await r.onSuccess(a,s,o)}})}function Z(r){const e=I(),{accessToken:i,keyFactory:l}=x();return R({...r,mutationFn:a=>{typeof a=="string"&&(a=new Set([a]));const s=Array.from(a).map(o=>C.purgeFromTrashCan(o,i));return Promise.allSettled(s)},onSuccess:async(a,s,o)=>{await e.invalidateQueries({queryKey:l.getTrashCanItemsQueryKey()}),r?.onSuccess&&await r.onSuccess(a,s,o)}})}function $(r){return r.filter(e=>e.status==="rejected").map(e=>e.reason)}const m=O();function ee(r){return[{id:"select",header:G,cell:W,maxSize:50},m.accessor("entityId",{header:"ID"}),m.accessor("entityName",{header:"Name"}),m.accessor("entityType",{header:"Entity Type",cell:e=>Q(e.getValue())}),m.accessor("originalParentId",{header:"Location",cell:e=>t.jsxs(t.Fragment,{children:[e.getValue()&&t.jsx(_,{entity:e.getValue()})," (",e.getValue(),")"]}),size:200}),m.accessor("deletedOn",{header:"Deleted On",cell:e=>q(K(e.getValue()))}),{id:"restoreButton",header:"",cell:({row:e})=>t.jsx(p,{size:"small",variant:"outlined",onClick:()=>{r(e.original.entityId),e.toggleSelected(!1)},children:"Restore"}),maxSize:100}]}function te(){const[r,e]=c.useState(!1),[i,l]=c.useState([]),[a,s]=c.useState({});function o(n,w){n?l($(n)):w&&l([w]),s({})}const{mutate:y,isPending:b}=X({onSettled:o}),{mutate:k,isPending:S}=Z({onSettled:o}),v=b||S,{data:T,isLoading:g,hasNextPage:F,fetchNextPage:E,isFetchingNextPage:M}=U({throwOnError:!0}),h=c.useMemo(()=>T?.pages.flatMap(n=>n.results)??[],[T]),B=c.useMemo(()=>ee(n=>{y(n)}),[y]),j=Y({data:h,columns:B,state:{rowSelection:a},getRowId:n=>n.entityId,enableRowSelection:!0,onRowSelectionChange:s,getCoreRowModel:A(),columnResizeMode:"onChange"}),u=j.getSelectedRowModel().rows.map(n=>n.original.entityId);return t.jsxs("div",{children:[t.jsx(D,{show:v,headlineText:S?"Deleting...":"Restoring..."}),t.jsx(f,{variant:"body1",children:'The trash can contains items that were recently deleted. You can recover deleted items in the trash can by clicking "Restore". Items will remain in the trash can for 30 days before being automatically purged.'}),t.jsx(J,{title:"Delete selected items from your Trash?",content:t.jsx(f,{variant:"body1",children:"You can't undo this action."}),confirmButtonText:"Delete",confirmButtonColor:"error",onConfirm:()=>{k(u),e(!1)},onCancel:()=>{e(!1)},open:r}),g&&t.jsx(L,{}),!g&&h.length===0&&t.jsx(P,{severity:"info",sx:{my:2},children:t.jsx(f,{variant:"body1",children:"Your trash can is currently empty."})}),!g&&h.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(H,{table:j,styledTableContainerProps:{sx:{my:4}}}),i.length>0&&t.jsxs(P,{severity:"error",sx:{mb:1},children:["The following errors were encountered:",t.jsx("ul",{style:{marginBottom:0},children:i.map(n=>t.jsx("li",{children:n.message},n.message))})]}),t.jsxs(N,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[F&&t.jsx(p,{variant:"contained",disabled:M,onClick:()=>{E()},children:"Load More"}),t.jsx("div",{style:{margin:"auto"}}),t.jsx(p,{variant:"contained",color:"error",disabled:u.length===0,onClick:()=>{e(!0)},children:"Delete Selected"}),t.jsx(p,{variant:"outlined",disabled:u.length===0,onClick:()=>{y(u)},children:"Restore Selected"})]})]})]})}const Qe={title:"Synapse/TrashCanList",component:te},d={};d.parameters={...d.parameters,docs:{...d.parameters?.docs,source:{originalSource:"{}",...d.parameters?.docs?.source}}};const qe=["TrashCan"];export{d as TrashCan,qe as __namedExportsOrder,Qe as default};
