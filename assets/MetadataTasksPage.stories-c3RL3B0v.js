import{V as S,j as r,cf as I,cg as C,kw as P,kx as M,cT as j,aF as G,an as F,aG as w,r as _,K as x,bP as R,B as q,$ as E,du as V,dt as B}from"./iframe-D4dZwAiu.js";import{I as N}from"./InfiniteTableLayout-or76Eo1i.js";import{u as O,c as A,g as D,S as v}from"./StyledTanStackTable-Dr210tTJ.js";import{C as l}from"./ColumnHeader-Bx5u8WFe.js";import{U as L}from"./UserBadge-C4q-1h63.js";import{a as $}from"./useCurationTask-DuQhLIqT.js";import{u as H}from"./useEntityBundle-ClqOATdC.js";import{g as U,d as Q}from"./useGridSession-BBPcubeT.js";import{j as z}from"./useEntity-CLsVNppT.js";import"./index-Chi_LkuB.js";import"./StyledTableContainer-CbdAUlBb.js";import"./ExpandCollapseButton-BTG508sA.js";import"./index-CKvmfddO.js";import"./EnumFacetFilterUI-rRRlOK5w.js";import"./FacetFilterHeader-uUJ71JRm.js";import"./FormControlLabel-xBFb-JxA.js";import"./Checkbox-8IZKAE9H.js";import"./SwitchBase-BC3YewNK.js";import"./Radio-wL87KhXk.js";import"./MenuItem-i2UFDYLy.js";import"./HelpTwoTone-Djbz0t5R.js";import"./useUserBundle-DJaOK7gx.js";import"./SkeletonTable-8IE5S5u8.js";import"./Card-BgubtV-0.js";import"./Chip-BrFyeTvK.js";import"./useInfiniteQuery-97YTJVGW.js";import"./waitForAsyncResult-Ce-jWYH-.js";import"./pickBy-Bir1C-NQ.js";import"./isString-B22YpsO2.js";import"./_baseIteratee-hrWHcORH.js";import"./InfiniteQueryUtils-CKlRW-xB.js";const W=S(r.jsx("path",{d:"M19 5v9h-5v5H5V5zm0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h10l6-6V5c0-1.1-.9-2-2-2m-7 11H7v-2h5zm5-4H7V8h10z"}));function u(a){const t=a.taskProperties;if(t==null)throw new Error("CurationTask is missing taskProperties");switch(t.concreteType){case"org.sagebionetworks.repo.model.curation.metadata.FileBasedMetadataTaskProperties":return t.fileViewId;case"org.sagebionetworks.repo.model.curation.metadata.RecordBasedMetadataTaskProperties":return t.recordSetId;default:throw new Error(`Unknown taskProperties concreteType: ${t.concreteType}`)}}try{u.displayName="getGridSourceIdForTask",u.__docgenInfo={description:`For a given CurationTask that could be used to create a GridSession, return the ID of the source entity that would be
used to create the GridSession.`,displayName:"getGridSourceIdForTask",props:{taskId:{defaultValue:null,description:`The unique identifier issued to this task when it was created.
@memberof CurationTask`,name:"taskId",required:!1,type:{name:"{number}"}},dataType:{defaultValue:null,description:`Will match the data type that a contributor plans to contribute.  The dataType must be unique within a project.
@memberof CurationTask`,name:"dataType",required:!1,type:{name:"{string}"}},projectId:{defaultValue:null,description:`The synId of the project.
@memberof CurationTask`,name:"projectId",required:!1,type:{name:"{string}"}},instructions:{defaultValue:null,description:`Instructions to the data contributor.
@memberof CurationTask`,name:"instructions",required:!1,type:{name:"{string}"}},etag:{defaultValue:null,description:`Synapse employs an Optimistic Concurrency Control (OCC) scheme to handle concurrent updates. Since the E-Tag changes every time an entity is updated it is used to detect when a client's current representation of an entity is out-of-date.
@memberof CurationTask`,name:"etag",required:!1,type:{name:"{string}"}},createdOn:{defaultValue:null,description:"@memberof CurationTask",name:"createdOn",required:!1,type:{name:"{string}"}},modifiedOn:{defaultValue:null,description:"@memberof CurationTask",name:"modifiedOn",required:!1,type:{name:"{string}"}},createdBy:{defaultValue:null,description:"@memberof CurationTask",name:"createdBy",required:!1,type:{name:"{string}"}},modifiedBy:{defaultValue:null,description:"@memberof CurationTask",name:"modifiedBy",required:!1,type:{name:"{string}"}},assigneePrincipalId:{defaultValue:null,description:`The principal ID of the user or team assigned to this task. Null if unassigned. For metadata tasks, determines the owner of the grid session. Team members can all join grid sessions owned by their team, while user-owned grid sessions are restricted to that user only.
@memberof CurationTask`,name:"assigneePrincipalId",required:!1,type:{name:"{string}"}},taskProperties:{defaultValue:null,description:"@memberof CurationTask",name:"taskProperties",required:!1,type:{name:"{CurationTaskProperties}"}}}}}catch{}function Y(a,t){return`${I(C.PORTAL_ENDPOINT)}Synapse:${a}`}function K(a,t){let e=`${I(C.PORTAL_ENDPOINT)}Grid:default?${P}=${encodeURIComponent(a)}`;return t!=null&&(e+=`&${M}=${t}`),e}function T(a){switch(a.concreteType){case"org.sagebionetworks.repo.model.curation.metadata.FileBasedMetadataTaskProperties":return{concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest",initialQuery:{sql:`SELECT * FROM ${a.fileViewId}`}};case"org.sagebionetworks.repo.model.curation.metadata.RecordBasedMetadataTaskProperties":return{concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest",recordSetId:a.recordSetId};default:throw new Error(`Unknown taskProperties concreteType: ${a.concreteType}`)}}try{T.displayName="getCreateGridRequestForMetadataTask",T.__docgenInfo={description:"Generates a CreateGridRequest for a metadata task based on its properties.",displayName:"getCreateGridRequestForMetadataTask",props:{concreteType:{defaultValue:null,description:`Indicates which implementation of CurationTaskProperties this object represents. Possible values include: 'org.sagebionetworks.repo.model.curation.metadata.FileBasedMetadataTaskProperties' and 'org.sagebionetworks.repo.model.curation.metadata.RecordBasedMetadataTaskProperties'.
@memberof FileBasedMetadataTaskProperties
@memberof RecordBasedMetadataTaskProperties`,name:"concreteType",required:!0,type:{name:`{string}
{string}`}},uploadFolderId:{defaultValue:null,description:`The synId of the folder where data files of this type are to be uploaded.
@memberof FileBasedMetadataTaskProperties`,name:"uploadFolderId",required:!1,type:{name:"{string}"}},fileViewId:{defaultValue:null,description:`The synId of the FileView that shows all data of this type.  This FileView will be used to start new grid sessions for file annotation curation.
@memberof FileBasedMetadataTaskProperties`,name:"fileViewId",required:!1,type:{name:"{string}"}},recordSetId:{defaultValue:null,description:`The synId of the RecordSet that will contain all record-based metadata for a specific type.  This RecordSet will be used to start new grid sessions for both 'upsert' and record-based curation for this type.
@memberof RecordBasedMetadataTaskProperties`,name:"recordSetId",required:!1,type:{name:"{string}"}}}}}catch{}async function J(a,t){const{queryClient:e}=t,{keyFactory:s,synapseClient:o}=t.synapseContext,n=await e.fetchQuery(U({sourceId:a},{keyFactory:s,synapseClient:o}));return j(n.page)?null:n.page[0]}function X(){const a=G(),t=F(),{mutateAsync:e}=Q();return w({mutationFn:async({sourceId:s,createRequest:o})=>{const n=await J(s,{queryClient:a,synapseContext:t});return n??(await e(o)).gridSession}})}function Z(){const{mutateAsync:a}=X();return w({mutationFn:async({curationTask:t})=>{const e=t.taskProperties;if(e==null)throw new Error("CurationTask is missing taskProperties");const s=u(t),o=T(e);return await a({sourceId:s,createRequest:o})}})}function h(a){const{curationTask:t}=a,{mutateAsync:e,isPending:s}=Z(),o=u(t),{data:n,isLoading:d}=z(o),m=s||d||!n?.canView,f=n?.canView?"Open Curator to edit metadata":"You must have READ access to "+o+" to view the Working Copy",g=_.useCallback(async()=>{try{const c=await e({curationTask:t}),i=K(c.sessionId,t.taskId);window.open(i,"_blank","noopener")}catch(c){console.error("Error opening Curator for curation task",c),x(c.message,"danger",{title:"An error occurred while trying to open Curator"})}},[t,e]),y=r.jsx(R,{title:f,children:r.jsx("span",{children:r.jsx(q,{size:"small",startIcon:r.jsx(W,{}),loading:s||d,disabled:m,onClick:()=>{g()},children:"Open Curator"})})});return r.jsx(r.Fragment,{children:y})}try{h.displayName="MetadataTaskTableActionCell",h.__docgenInfo={description:`Handles rendering the 'Actions' cell in the Metadata Task table, which provides buttons for the user
to accomplish the actions they can take on a Metadata Task, such as opening a data grid for the entity referenced
by the task.`,displayName:"MetadataTaskTableActionCell",props:{curationTask:{defaultValue:null,description:"",name:"curationTask",required:!0,type:{name:"CurationTask"}},canEdit:{defaultValue:null,description:"",name:"canEdit",required:!0,type:{name:"boolean"}}}}}catch{}function ee(a){const t=A();return[t.accessor("dataType",{header:e=>r.jsx(l,{...e,title:"Tasks"}),cell:({row:e,getValue:s})=>{const o=u(e.original);return r.jsx(E,{href:Y(o),children:s()})},enableSorting:!1,enableColumnFilter:!1}),t.accessor("instructions",{header:e=>r.jsx(l,{...e,title:"Instructions"}),cell:({getValue:e})=>r.jsx("p",{children:e()}),enableSorting:!1,enableColumnFilter:!1}),t.accessor("modifiedBy",{header:e=>r.jsx(l,{...e,title:"Modified By"}),cell:({getValue:e})=>r.jsx(L,{userId:e()}),enableSorting:!1,enableColumnFilter:!1}),t.accessor("modifiedOn",{header:e=>r.jsx(l,{...e,title:"Modified On"}),cell:({getValue:e})=>V(B(e())),enableSorting:!1,enableColumnFilter:!1}),t.display({id:"actions",header:e=>r.jsx(l,{...e,title:"Actions"}),cell:({row:e})=>r.jsx(h,{curationTask:e.original,canEdit:a})})]}function k(a){const{projectId:t}=a,{data:e,hasNextPage:s,fetchNextPage:o,isLoading:n,isFetchingNextPage:d}=$(t),{data:m,isLoading:f}=H(t),g=m?.permissions?.canEdit??!1,y=_.useMemo(()=>e?.pages.flatMap(i=>i.page)??[],[e]);return{table:O({data:y,columns:ee(g),getRowId:i=>String(i.taskId),getCoreRowModel:D(),columnResizeMode:"onChange",manualSorting:!1,meta:{getWrapInExpandableTd:i=>i.column.id==="instructions"}}),isLoading:n||f,hasNextPage:s,fetchNextPage:o,isFetchingNextPage:d}}try{k.displayName="useMetadataTaskTable",k.__docgenInfo={description:"Provides a table instance and loading states for displaying metadata curation tasks associated with a project.",displayName:"useMetadataTaskTable",props:{projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}}}}}catch{}function b(a){const{projectId:t}=a,{table:e,isLoading:s,hasNextPage:o,fetchNextPage:n,isFetchingNextPage:d}=k({projectId:t});return r.jsx(N,{table:r.jsx(v,{table:e,styledTableContainerProps:{sx:{my:2}}}),isLoading:s,isEmpty:!s&&e.getRowModel().rows.length===0,hasNextPage:o,onFetchNextPageClicked:()=>{n()},isFetchingNextPage:d})}try{b.displayName="MetadataTasksPage",b.__docgenInfo={description:"Displays a list of metadata curation tasks for a particular project, with actions that can be performed on each task.",displayName:"MetadataTasksPage",props:{projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}}}}}catch{}const Re={title:"Synapse/Entity/MetadataTaskTable",component:b},p={name:"MetadataTaskTable",args:{projectId:"syn12554559"},parameters:{stack:"development"}};p.parameters={...p.parameters,docs:{...p.parameters?.docs,source:{originalSource:`{
  name: 'MetadataTaskTable',
  args: {
    projectId: 'syn12554559'
  },
  parameters: {
    stack: 'development'
  }
}`,...p.parameters?.docs?.source}}};const qe=["Demo"];export{p as Demo,qe as __namedExportsOrder,Re as default};
