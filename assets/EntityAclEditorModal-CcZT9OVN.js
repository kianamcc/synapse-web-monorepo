import{j as e,Y as C,B as H,al as de,dh as w,c$ as ue,$ as z,r as l,K as Y,bV as pe,di as fe,ag as he,ay as me,c8 as M,c4 as ye,cr as ge,cs as Ie,c7 as W,c9 as Ae}from"./iframe-Dmz0OYQW.js";import{C as Se}from"./ConfirmCloseWithoutSavingDialog-BvOEOYjK.js";import{b as Ee,A as Ce,u as be}from"./useEntityBundle-U54fuo6y.js";import{C as ve}from"./ConfirmationDialog-91A2i7b8.js";import{a as _e,b as Le,c as Ne,d as je}from"./useEntity-DCJfD9JE.js";import{d as Te,f as we}from"./useUserBundle-BQiPRbYK.js";import{r as xe}from"./AccessControlListUtils-BEX0jsOx.js";import{u as K}from"./useRealmPrincipals-B2GYlSoD.js";import{a as Ue,A as Pe}from"./AclEditor-Bcpu0WWQ.js";import{u as De}from"./useUpdateAcl-QVRWxVPt.js";import{u as Re}from"./useGetEntityHeaders-BnMPdQ_k.js";import{E as F}from"./EntityLink-B8y_f3c3.js";import{O as Ge}from"./OpenData-CUAwRnV_.js";import{u as Oe}from"./useMessage-mcPxLdkD.js";import{u as Ve}from"./UserBadge-Dn0Lha6s.js";function ke(t,s){return t?s?` (${t})`:t:""}function Be(t,s,r){let i="",n=!1;return t&&(i+=t.trim(),n=!0),s&&(i+=" "+s.trim(),n=!0),i+=ke(r,n),i}function qe(t){return Be(t.firstName,t.lastName,t.userName)}const He="Create local sharing settings",Me="Delete local sharing settings";function P(t){const{isInherited:s,setIsInherited:r}=t;return s?e.jsxs("div",{children:[e.jsx(C,{variant:"body1",sx:{mt:2,mb:1},children:"Sharing settings are initially inherited from the parent folder or project by default. To customize settings for a specific file, folder, or table, you must create and adjust local sharing settings."}),e.jsx(H,{variant:"contained",size:"small",color:"success",startIcon:e.jsx(de,{icon:"add",wrap:!1}),onClick:()=>r(!1),children:He})]}):e.jsxs("div",{children:[e.jsx(C,{variant:"body1",sx:{mt:2,mb:1},children:"The sharing settings will be inherited from the parent folder or project if local sharing settings are deleted."}),e.jsx(H,{variant:"outlined",size:"small",color:"error",onClick:()=>r(!0),children:Me})]})}try{P.displayName="CreateOrDeleteLocalSharingSettingsButton",P.__docgenInfo={description:"",displayName:"CreateOrDeleteLocalSharingSettingsButton",props:{isInherited:{defaultValue:null,description:"",name:"isInherited",required:!0,type:{name:"boolean"}},setIsInherited:{defaultValue:null,description:"",name:"setIsInherited",required:!0,type:{name:"(isInherited: boolean) => void"}}}}}catch{}function D(t){const{isProject:s,isInherited:r,isAfterUpload:i=!1,benefactorId:n}=t,{data:u}=Re(n,void 0,{enabled:!!n});return i?e.jsxs(e.Fragment,{children:[e.jsxs(C,{variant:"body1",children:["Currently, the sharing settings are inherited from the"," ",u?w(ue(u.type)).toLowerCase():"container"," ","named",n?e.jsxs(e.Fragment,{children:[" ",e.jsx(F,{entity:n})," "]}):"",". If you wish to customize settings for a particular file, folder, or table, you must establish ",e.jsx("strong",{children:"Local Sharing Settings"})," to make modifications."]}),e.jsxs(C,{variant:"body1",children:["After uploading, choose the file you want to customize sharing settings for, then navigate to File Tools >"," ",e.jsx(z,{href:"https://help.synapse.org/docs/Sharing-Settings,-Permissions,-and-Conditions-for-Use.2024276030.html",children:"File Sharing Settings"}),"."]})]}):s?e.jsx(C,{variant:"body1",children:"The sharing settings shown below apply to this project and are inherited by all project contents unless local sharing settings have been set."}):r?e.jsxs(C,{variant:"body1",children:["The sharing settings shown below are currently being inherited"," ",n?e.jsxs(e.Fragment,{children:["from ",e.jsx(F,{entity:n})," "]}):"","and cannot be modified here."]}):e.jsxs(C,{variant:"body1",children:["The local sharing settings shown below are ",e.jsx("strong",{children:"not"})," being inherited from a parent resource."]})}try{D.displayName="InheritanceMessage",D.__docgenInfo={description:"",displayName:"InheritanceMessage",props:{isProject:{defaultValue:null,description:"",name:"isProject",required:!0,type:{name:"boolean"}},isInherited:{defaultValue:null,description:"",name:"isInherited",required:!0,type:{name:"boolean"}},isAfterUpload:{defaultValue:null,description:"",name:"isAfterUpload",required:!1,type:{name:"boolean"}},benefactorId:{defaultValue:null,description:"",name:"benefactorId",required:!1,type:{name:"string"}}}}}catch{}function We(t,s,r,i,n){const u=s.some(I=>t===I.principalId),p=r.isIndividual,f=String(t)===i,m=n.includes(String(t));return!u&&p&&!f&&!m}function Fe(t){const{subject:s,body:r,initialResourceAccessList:i,newResourceAccessList:n}=t,{data:u}=K(),p=u||{},{authenticatedUsers:f,publicGroup:m,anonymousUser:I}=p,h=[f,m,I].filter(a=>a!==void 0),{data:y,isLoading:d}=Te(),{data:A,isLoading:S}=Ve(n.map(a=>String(a.principalId))),c=d||S,{mutate:v,isPending:_}=Oe({onError:a=>{Y(`New users couldn't be notified: ${a.reason}`)}});return{sendNotification:l.useCallback(()=>{if(c){console.error("Attempted to send notification before user profile or user group headers were loaded. This should never happen.");return}const a=n.filter(o=>{const N=A.find(j=>j.ownerId===String(o.principalId));return We(o.principalId,i,N,y.ownerId,h)}).map(o=>String(o.principalId));a.length>0&&v({subject:s,body:r,recipients:a})},[r,y,i,c,n,h,v,s,A]),isPending:_,isLoading:c}}const $e=["CAN_VIEW","CAN_DOWNLOAD","CAN_EDIT","CAN_EDIT_DELETE","CAN_ADMINISTER"];function ze(t){return`${t} (shared on Synapse)`}function Ye(t,s){return`${qe(t)} has shared an item with you on Synapse:
${ge(Ie.PORTAL_ENDPOINT)}Synapse:${s}`}function Ke(t,s,r,i){return!t||s?!1:n=>{const u=r.ownerId===String(n.principalId),p=i!==void 0&&String(n.principalId)===i;return!(u||p)}}function Je(t,s,r){return!t||s?!1:i=>r.ownerId===String(i.principalId)?!1:t}function Qe(t,s){return r=>{if(s!==void 0&&String(r.principalId)===s)return t?W.CAN_DOWNLOAD:W.CAN_VIEW}}const R=l.forwardRef(function(s,r){const{entityId:i,onCanSaveChange:n,onUpdateSuccess:u,isAfterUpload:p=!1}=s,{data:f}=we(),{data:m}=K(),{authenticatedUsers:I,publicGroup:h,anonymousUser:y}=m||{},{data:d}=Ee(i,void 0,Ce,{staleTime:1/0}),A=fe.project==d.entityType,{data:S}=_e(d.entity.parentId,{staleTime:1/0}),c=d.benefactorAcl.resourceAccess,v=l.useMemo(()=>S?.resourceAccess??[],[S]),_=d.permissions.canChangePermissions,x=d.permissions.isEntityOpenData,a=d.benefactorAcl.id!=i,[o,N]=l.useState(a),[j,J]=l.useState(!1),[G,Q]=l.useState(),{resourceAccessList:g,setResourceAccessList:L,addResourceAccessItem:O,updateResourceAccessItem:X,removeResourceAccessItem:Z,resetDirtyState:b}=De({initialResourceAccessList:c});l.useEffect(()=>{c&&(b(),L([...c]))},[c,b,L]),l.useEffect(()=>{b(),N(a)},[a,b]),l.useEffect(()=>{a==o?L(c):o&&L(v),b()},[a,c,v,b,L,o]);const ee=g.some(E=>[I,h,y].filter(le=>le!==void 0).includes(String(E.principalId))),{sendNotification:te,isLoading:se,isPending:ne}=Fe({subject:ze(d.entity.name||""),body:Ye(f,i),initialResourceAccessList:c,newResourceAccessList:g}),U={onSuccess:()=>{j&&te(),u()},onError:E=>{Q(E)}},{mutate:V,isPending:ie}=Le(U),{mutate:k,isPending:re}=Ne(U),{mutate:B,isPending:oe}=je(U),ae=ie||re||oe||ne,q=l.useMemo(()=>a!=o||!xe(c,g),[c,a,o,g]),T=q||se||ae,ce=q&&p;return l.useEffect(()=>{n(T)},[n,T]),l.useImperativeHandle(r,()=>({save(){T?a!=o?o?B(i):V({id:i,resourceAccess:g}):k({...d.accessControlList,resourceAccess:g}):console.error("EntityAclEditor: save() called but canSave is false")}}),[T,V,B,d,i,a,k,o,g]),e.jsxs(he,{sx:{gap:2},children:[e.jsx(Ge,{isOpenData:x,isPublic:ee,currentUserCanUpdateSharingSettings:_}),e.jsx(D,{isProject:A,isInherited:o,benefactorId:o?S?.id:i,isAfterUpload:p}),ce&&e.jsx(me,{isGlobal:!1,variant:"warning",title:`Edits will affect settings of entire ${w(d?.entityType).toLowerCase()}.`,description:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Editing the settings here will impact the sharing settings for all files and folders within this"," ",w(d?.entityType).toLowerCase(),", not just the ones you've recently uploaded."]}),e.jsxs("p",{children:["View the instructions above for setting your"," ",e.jsx(z,{href:"https://help.synapse.org/docs/Sharing-Settings,-Permissions,-and-Conditions-for-Use.2024276030.html",target:"_blank",children:"Local Sharing Settings"}),"."]})]})}),e.jsx(Pe,{isInherited:o,canEdit:Ke(_,o,f,h),canRemoveEntry:Je(_,o,f),resourceAccessList:g,availablePermissionLevels:$e,emptyText:"",displayedPermissionLevelOverride:Qe(x,h),onAddPrincipalToAcl:E=>{h!==void 0&&String(E)===h?O(E,M("CAN_VIEW")):O(E,M("CAN_DOWNLOAD"))},updateResourceAccessItem:X,removeResourceAccessItem:Z,showNotifyCheckbox:!0,notifyCheckboxValue:j,onNotifyCheckboxChange:J,showAddRemovePublicButton:!0}),!p&&!A&&d.permissions.canEnableInheritance&&e.jsx(P,{isInherited:o,setIsInherited:N}),G&&e.jsx(ye,{severity:"error",children:G.message})]})}),Xe=l.forwardRef(function(s,r){return e.jsx(pe,{children:e.jsx(l.Suspense,{fallback:e.jsx(Ue,{}),children:e.jsx(R,{...s,ref:r})})})});try{R.displayName="EntityAclEditor",R.__docgenInfo={description:"",displayName:"EntityAclEditor",props:{entityId:{defaultValue:null,description:"The ID of the entity on which to view/edit the ACL. Note that the ACL may actually belong to an entity ancestor (benefactor).",name:"entityId",required:!0,type:{name:"string"}},onCanSaveChange:{defaultValue:null,description:"Invoked when the user can/cannot save the pending changes.",name:"onCanSaveChange",required:!0,type:{name:"(canSaveChanges: boolean) => void"}},onUpdateSuccess:{defaultValue:null,description:"Invoked when changes are successfully made.",name:"onUpdateSuccess",required:!0,type:{name:"() => void"}},isAfterUpload:{defaultValue:null,description:`Special case to show specific copy and allow changes to an inherited ACL immediately after a file is uploaded.
Note that if this is true, the entityId should be the ID of the folder or project that is the benefactor of the newly uploaded file(s)
@defaultValue false`,name:"isAfterUpload",required:!1,type:{name:"boolean"}}}}}catch{}const Ze=`Sharing settings determine who can access your content, and what kind of access they have. Choose people/teams and define their level of access below.

_Only Administrators can add, delete, or change access levels for other people._`,et="https://help.synapse.org/docs/Sharing-Settings,-Permissions,-and-Conditions-for-Use.2024276030.html";function $(t){const{entityId:s,open:r,onUpdateSuccess:i=Ae,onClose:n,isAfterUpload:u=!1}=t,[p,f]=l.useState(!1),[m,I]=l.useState(!1),h=l.useRef(null),{data:y}=be(s),d=y?.entityType?w(y?.entityType):"",A=y?.permissions?.canChangePermissions;function S(){m?f(!0):n()}return e.jsxs(e.Fragment,{children:[e.jsx(Se,{open:p,onCancel:()=>{f(!1)},onConfirm:()=>{f(!1),n()}}),e.jsx(ve,{title:`${d} Sharing Settings`.trim(),onCancel:S,open:r,maxWidth:"md",titleHelpPopoverProps:{markdownText:Ze,helpUrl:et},content:e.jsx(Xe,{ref:h,entityId:s,onCanSaveChange:c=>I(c),onUpdateSuccess:()=>{Y("Permissions were successfully saved to Synapse","info"),i(),n()},isAfterUpload:u}),onConfirm:c=>{c.preventDefault(),h.current.save()},confirmButtonProps:{children:A?"Save":"OK",disabled:!m}})]})}try{$.displayName="EntityAclEditorModal",$.__docgenInfo={description:"",displayName:"EntityAclEditorModal",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onUpdateSuccess:{defaultValue:null,description:"",name:"onUpdateSuccess",required:!1,type:{name:"() => void"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isAfterUpload:{defaultValue:null,description:"",name:"isAfterUpload",required:!1,type:{name:"boolean"}}}}}catch{}export{$ as E};
