import{an as v,am as M,aH as O,aI as K,ab as T,as as q,he as G,r as m,j as e,c4 as j,hY as w,Y as a,$ as C,dG as $,dF as Y,B as I,W as _,by as E,c1 as V,K as P}from"./iframe-Dmz0OYQW.js";import{d as W,e as J}from"./useUserBundle-BQiPRbYK.js";import{M as X}from"./MarkdownPopover-BJM8rGXo.js";import"./SkeletonButton--ocR4MjZ.js";import"./SkeletonInlineBlock-DMCr-ZDU.js";import{S as Z}from"./SkeletonTable-DZOOfuw_.js";import{S as ee}from"./SkeletonParagraph-BbQFsbPl.js";import{C as B}from"./CertificationAnswer-CodeNY0h.js";import"./index-Chi_LkuB.js";import"./useSuspenseQuery-DBtfLQcz.js";import"./LightTooltip-B4ee2TOH.js";import"./MarkdownSynapse-BRO4x38K.js";const se="org.sagebionetworks.repo.model.quiz.MultichoiceResponse";function te(n="",r){const{accessToken:d,keyFactory:i}=v();return M({...r,queryKey:i.getPassingRecordQueryKey(n),queryFn:()=>T.getPassingRecord(n,d)})}function ne(n){const r=O(),{accessToken:d,keyFactory:i}=v(),{data:f}=W();return K({...n,mutationFn:u=>T.postCertifiedUserTestResponse(d,u),onSuccess:async(u,x,p)=>{await Promise.all([r.invalidateQueries({queryKey:i.getPassingRecordQueryKey(f?.ownerId)}),r.invalidateQueries({queryKey:i.getUserBundleQueryKey("current",q)})]),n?.onSuccess&&await n.onSuccess(u,x,p)}})}function re(){const{accessToken:n,isAuthenticated:r}=v(),d=G(),[i,f]=m.useState(),[u,x]=m.useState(!1),[p,S]=m.useState([]),{data:k}=J(q),h=k?.isCertified,R=k?.userId,{data:t,isLoading:N}=te(R,{enabled:R!==void 0}),z=m.useRef(null),U="https://help.synapse.org/docs/Getting-Started.2055471150.html",Q=async()=>{try{f(await T.getCertifyQuiz(n))}catch(s){d(s)}},{mutate:F,isPending:L}=ne({onSuccess:()=>{x(!1),window.scrollTo(0,0)},throwOnError:!0}),y=!h&&(t==null||u);if(m.useEffect(()=>{r&&Q()},[r]),N||i==null)return e.jsx(ie,{});const H=(s,o)=>{const l=[...p.filter(c=>c.questionIndex!==s),{questionIndex:s,answerIndex:[o],concreteType:se}];S(l)},b=()=>{z.current?.reset(),x(!0),S([]),Q()},A=()=>{try{if(i&&i.questions.length===p.length){const s={quizId:i.id,questionResponses:p};F(s)}else P("Please answer all of the questions and try again.","warning")}catch(s){P(s.reason,"danger")}},D=s=>s?{content:e.jsx(e.Fragment,{children:"More info"}),closePopoverOnClick:!0,onClick:()=>window.open(s,"_blank"),color:"primary"}:void 0;return e.jsxs("div",{children:[t&&!y&&e.jsxs(e.Fragment,{children:[(t.revokedOn||t.passed)&&!h&&e.jsxs(j,{severity:"error",children:[!t.passed&&e.jsx(w,{children:"Certification Revoked"}),e.jsxs(a,{variant:"body1",sx:{marginTop:"5px"},children:["Your certification was revoked. To become certified, you must"," ",e.jsx(C,{href:"#",onClick:s=>{s.preventDefault(),b()},children:"retake the quiz"}),"."]})]}),!t.passed&&!h&&e.jsxs(j,{severity:"error",children:[!t.passed&&e.jsx(w,{children:"Quiz Failed"}),e.jsxs(a,{variant:"body1",sx:{marginTop:"5px"},children:["Please review the results from the previous attempt, and"," ",e.jsx(C,{href:"#",onClick:s=>{s.preventDefault(),b()},children:"retake the quiz"}),"."]})]}),t.passed&&h&&e.jsxs(j,{severity:"success",children:[e.jsx(w,{children:"Quiz Passed"}),e.jsx(a,{variant:"body1",sx:{marginTop:"5px"},children:`You passed the Synapse Certification Quiz on ${$(Y(t.passedOn))}`})]}),e.jsxs(a,{variant:"sectionTitle",sx:{marginTop:"20px",marginBottom:"20px"},children:["Score: ",t.score," / ",t.corrections?.length]})]}),e.jsxs("div",{className:"CertificationQuiz__container",children:[i&&y&&e.jsxs(e.Fragment,{children:[e.jsx(I,{onClick:()=>window.open(U,"_blank"),className:"help-button",color:"primary",variant:"contained",children:e.jsxs(_,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(E,{className:"HelpButton",style:{marginRight:"4px",color:"white"}}),e.jsx(e.Fragment,{children:"Help"})]})}),e.jsx(a,{variant:"headline1",sx:{marginBottom:"25px"},children:"Certified User Quiz"}),e.jsx(a,{variant:"body1",sx:{marginBottom:"15px"},children:"Certified users are authorized to use the full Synapse functionality. In order to ensure that users who create content in the system and/or wish to interact more freely within Synapse are familiar with the governance process and Synapse operating procedures when dealing with possibly sensitive data, users must pass a short quiz (approximately 15 minutes) to become Synapse certified."}),e.jsx(a,{variant:"body1",sx:{marginBottom:"15px"},children:"Please answer the following questions to become certified."}),e.jsx("form",{ref:z,onSubmit:s=>s.preventDefault(),children:e.jsx("ol",{children:i?.questions.map(s=>{const o=s.helpText||s.docLink;return e.jsxs("li",{role:s.exclusive?"radiogroup":void 0,children:[e.jsx(a,{variant:"headline3",dangerouslySetInnerHTML:{__html:s.prompt},sx:{marginTop:"40px",marginBottom:"10px"}}),s.answers.map(l=>e.jsx(B,{question:s,answer:l,onClick:c=>H(s.questionIndex,Number(c.currentTarget.value))},`${s.questionIndex}-${l.answerIndex}`)),o&&e.jsx(X,{contentProps:{markdown:s.helpText},placement:"right",sx:{table:{textAlign:"center",th:{padding:"5px"}}},actionButton:D(s.docLink),showCloseButton:!0,children:e.jsxs(_,{sx:{display:"flex",alignItems:"center",marginTop:"10px"},children:[e.jsx(E,{className:"HelpButton",style:{marginRight:"4px"}}),e.jsx(C,{children:"Need help answering this question?"})]})})]},s.questionIndex)})})}),e.jsx(I,{className:"help-button",color:"primary",variant:"contained",size:"large",disabled:L,onClick:()=>{A()},children:"Submit"})]}),!y&&t?.corrections&&e.jsx("ol",{children:t.corrections.map(s=>{const o=s.question,l=s.response;return e.jsxs("li",{children:[e.jsx(a,{variant:"headline3",dangerouslySetInnerHTML:{__html:o.prompt},className:s.isCorrect?"":"incorrectQuestion",sx:{marginTop:"40px",marginBottom:"10px"}}),o.answers.map(c=>e.jsx(B,{question:o,answer:c,disabled:!0,checked:l.answerIndex.includes(c.answerIndex)},`${o.questionIndex}-${c.answerIndex}`))]},o.questionIndex)})})]})]})}function ie(){const n=[];for(let r=0;r<20;r++)n.push(e.jsx("li",{children:e.jsx(Z,{numCols:1,numRows:5})},r));return e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(V,{height:"80px",width:"460px"})}),e.jsx(ee,{numRows:5}),e.jsx("div",{className:"CertificationQuiz__container",children:e.jsx("ol",{style:{marginTop:"20px"},children:n})})]})}const ye={title:"Synapse/CertificationQuiz",component:re},g={};g.parameters={...g.parameters,docs:{...g.parameters?.docs,source:{originalSource:"{}",...g.parameters?.docs?.source}}};const je=["CertificationQuizDemo"];export{g as CertificationQuizDemo,je as __namedExportsOrder,ye as default};
