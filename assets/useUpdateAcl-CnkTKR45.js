import{a4 as I,b_ as L,r,bZ as G,c0 as h}from"./iframe-D4dZwAiu.js";import{u as y}from"./UserBadge-C4q-1h63.js";function T(e,c,n,t){let u;(o=>{o[o.A_FIRST=-1]="A_FIRST",o[o.B_FIRST=1]="B_FIRST"})(u||(u={}));const a=e.resourceAccess.accessType.includes(I.CHANGE_PERMISSIONS),i=c.resourceAccess.accessType.includes(I.CHANGE_PERMISSIONS);return a&&!i?-1:!a&&i?1:n&&String(e.resourceAccess.principalId)===n&&String(c.resourceAccess.principalId)!==n?-1:n&&String(e.resourceAccess.principalId)!==n&&String(c.resourceAccess.principalId)===n?1:t&&String(e.resourceAccess.principalId)===t&&String(c.resourceAccess.principalId)!==t?-1:t&&String(e.resourceAccess.principalId)!==t&&String(c.resourceAccess.principalId)===t?1:e.userGroupHeader.userName.localeCompare(c.userGroupHeader.userName)}function U(e){const{data:c}=L(),n=c||{},{authenticatedUsers:t,publicGroup:u}=n,a=r.useMemo(()=>e.map(l=>l.principalId),[e]),{data:i,isLoading:o,error:d}=y(a.map(String),{enabled:a.length>0});return r.useEffect(()=>{d&&console.error("Error fetching user group headers: ",d)},[d]),{sortedResourceAccessList:r.useMemo(()=>{if(!i)return null;const l=e.map(s=>({resourceAccess:s,userGroupHeader:i.find(S=>String(S.ownerId)===String(s.principalId))}));return l.every(s=>!!s.userGroupHeader)?l.toSorted((s,S)=>T(s,S,t,u)).map(s=>s.resourceAccess):(console.warn("Some ACL entries do not have a corresponding UserGroupHeader. The ResourceAccess list will not be sorted. Missing entries: ",l.filter(s=>!s.userGroupHeader)),null)},[e,i,t,u]),isLoading:o}}const v="User or team already has permissions.",D=[];function w(e={}){const{initialResourceAccessList:c=D,onChange:n=G,onError:t=G}=e,[u,a]=r.useState(!1),{setIsEditing:i}=h();r.useEffect(()=>(i(u),()=>{i(!1)}),[u,i]);const[o,d]=r.useState(c),[g,l]=r.useState(!1),{sortedResourceAccessList:R,isLoading:s}=U(o);r.useEffect(()=>{!u&&!s&&!g&&R!=null&&(d(R),l(!0))},[g,u,s,R]),r.useEffect(()=>{n(o)},[o]);const S=r.useCallback((p,f)=>{a(!0),p&&d(A=>{if(A.some(E=>E.principalId===p))t(v);else{const E={principalId:p,accessType:f};return[...A,E]}return A})},[t]),H=r.useCallback((p,f)=>{a(!0),d(A=>A.map(m=>m.principalId===p?{...m,accessType:f}:m))},[]),C=r.useCallback(p=>{a(!0),d(f=>f.filter(A=>A.principalId!==p))},[]),_=r.useCallback(()=>{a(!1)},[]);return{resourceAccessList:o,setResourceAccessList:d,addResourceAccessItem:S,updateResourceAccessItem:H,removeResourceAccessItem:C,resetDirtyState:_}}export{w as u};
