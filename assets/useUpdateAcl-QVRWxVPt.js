import{a4 as I,r,c9 as G,cb as L}from"./iframe-Dmz0OYQW.js";import{u as h}from"./UserBadge-Dn0Lha6s.js";import{u as y}from"./useRealmPrincipals-B2GYlSoD.js";function T(e,c,n,o){let u;(t=>{t[t.A_FIRST=-1]="A_FIRST",t[t.B_FIRST=1]="B_FIRST"})(u||(u={}));const a=e.resourceAccess.accessType.includes(I.CHANGE_PERMISSIONS),i=c.resourceAccess.accessType.includes(I.CHANGE_PERMISSIONS);return a&&!i?-1:!a&&i?1:n&&String(e.resourceAccess.principalId)===n&&String(c.resourceAccess.principalId)!==n?-1:n&&String(e.resourceAccess.principalId)!==n&&String(c.resourceAccess.principalId)===n?1:o&&String(e.resourceAccess.principalId)===o&&String(c.resourceAccess.principalId)!==o?-1:o&&String(e.resourceAccess.principalId)!==o&&String(c.resourceAccess.principalId)===o?1:e.userGroupHeader.userName.localeCompare(c.userGroupHeader.userName)}function U(e){const{data:c}=y(),n=c||{},{authenticatedUsers:o,publicGroup:u}=n,a=r.useMemo(()=>e.map(d=>d.principalId),[e]),{data:i,isLoading:t,error:p}=h(a.map(String),{enabled:a.length>0});return r.useEffect(()=>{p&&console.error("Error fetching user group headers: ",p)},[p]),{sortedResourceAccessList:r.useMemo(()=>{if(!i)return null;const d=e.map(s=>({resourceAccess:s,userGroupHeader:i.find(S=>String(S.ownerId)===String(s.principalId))}));return d.every(s=>!!s.userGroupHeader)?d.toSorted((s,S)=>T(s,S,o,u)).map(s=>s.resourceAccess):(console.warn("Some ACL entries do not have a corresponding UserGroupHeader. The ResourceAccess list will not be sorted. Missing entries: ",d.filter(s=>!s.userGroupHeader)),null)},[e,i,o,u]),isLoading:t}}const v="User or team already has permissions.",D=[];function O(e={}){const{initialResourceAccessList:c=D,onChange:n=G,onError:o=G}=e,[u,a]=r.useState(!1),{setIsEditing:i}=L();r.useEffect(()=>(i(u),()=>{i(!1)}),[u,i]);const[t,p]=r.useState(c),[g,d]=r.useState(!1),{sortedResourceAccessList:R,isLoading:s}=U(t);r.useEffect(()=>{!u&&!s&&!g&&R!=null&&(p(R),d(!0))},[g,u,s,R]),r.useEffect(()=>{n(t)},[t]);const S=r.useCallback((l,f)=>{a(!0),l&&p(A=>{if(A.some(E=>E.principalId===l))o(v);else{const E={principalId:l,accessType:f};return[...A,E]}return A})},[o]),H=r.useCallback((l,f)=>{a(!0),p(A=>A.map(m=>m.principalId===l?{...m,accessType:f}:m))},[]),C=r.useCallback(l=>{a(!0),p(f=>f.filter(A=>A.principalId!==l))},[]),_=r.useCallback(()=>{a(!1)},[]);return{resourceAccessList:t,setResourceAccessList:p,addResourceAccessItem:S,updateResourceAccessItem:H,removeResourceAccessItem:C,resetDirtyState:_}}export{O as u};
